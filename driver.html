<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b2233" />
  <title>Apéro de nuit • Espace Livreur</title>

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./icons/icon-192.png" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />

  <!-- Styles -->
  <link rel="stylesheet" href="./style.css" />

  <!-- Leaflet (carte) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
    defer
  ></script>

  <!-- OneSignal v16 (page SDK) -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
</head>

<body>
  <!-- PIN Overlay -->
  <div id="pinOverlay" class="overlay">
    <div class="overlay-card">
      <div class="overlay-title">Accès Livreur</div>
      <div class="overlay-sub">Entre le code PIN pour ouvrir l’espace livreur.</div>

      <div class="overlay-row">
        <input id="pinInput" class="overlay-input" type="password" inputmode="numeric" autocomplete="one-time-code" placeholder="PIN" />
        <button id="pinBtn" class="btn btn-primary overlay-btn">Valider</button>
      </div>

      <div id="pinErr" class="overlay-error" aria-live="polite"></div>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="app" style="display:none;">
    <!-- Top bar -->
    <div class="topbar">
      <div class="brand">
        <img class="brand-logo" src="./assets/logo.png" alt="Apéro de nuit" onerror="this.style.display='none'" />
        <div class="brand-text">
          <div class="brand-name">APERO de nuit</div>
          <div class="brand-sub">Espace Livreur</div>
        </div>
      </div>

      <div class="right">
        <div id="driverOnlineLabel" class="badge">Livreur hors ligne</div>
      </div>
    </div>

    <div class="container">
      <h1 class="title">Espace Livreur</h1>

      <!-- KPI cards -->
      <div class="card kpis">
        <div class="kpi">
          <div class="kpi-label">GPS livreur</div>
          <div id="gpsStatus" class="kpi-value">—</div>
        </div>

        <div class="kpi">
          <div class="kpi-label">Dernière mise à jour</div>
          <div id="lastUpdate" class="kpi-value">—</div>
        </div>

        <div class="kpi">
          <div class="kpi-label">Demandes</div>
          <div id="requestCount" class="kpi-value">—</div>
        </div>

        <div class="kpi">
          <div class="kpi-label">Notifications</div>
          <div id="pushState" class="kpi-value">—</div>
        </div>

        <div class="actions">
          <button id="btnStart" class="btn btn-primary">Activer GPS</button>
          <button id="btnPushEnable" class="btn btn-secondary">Activer notifications</button>
          <button id="btnStop" class="btn btn-danger" disabled>Arrêter GPS</button>
          <button id="btnCenter" class="btn btn-primary">Recentrer</button>
        </div>

        <!-- Debug push (utile pour toi quand ça merde) -->
        <div id="pushDebug" class="hint" aria-live="polite"></div>
      </div>

      <!-- Map -->
      <div class="card map-wrap">
        <div id="map" class="map"></div>
        <div class="health">
          L’abus d’alcool est dangereux pour la santé, à consommer avec modération.
        </div>
      </div>

      <!-- Requests -->
      <div class="card">
        <h2 class="section-title">Demandes & suivis</h2>
        <div class="hint">
          Astuce : <b>+5 / -5</b> ajuste le temps (max 30 min). <b>Stop</b> coupe immédiatement.
        </div>

        <h3 class="sub-title">En attente</h3>
        <div id="listPending" class="list"></div>

        <h3 class="sub-title">Actifs</h3>
        <div id="listActive" class="list"></div>
      </div>
    </div>
  </div>

  <!-- App scripts -->
  <script type="module" src="./driver.js"></script>
</body>
</html>
